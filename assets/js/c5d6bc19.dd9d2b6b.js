"use strict";(self.webpackChunkscience_island_docs=self.webpackChunkscience_island_docs||[]).push([[6830],{293:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>h,frontMatter:()=>d,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"guides/cloud-environment/deployment","title":"Current Production Deployment (GCP Runtime)","description":"This page describes the final deployed production environment for Science Island on Google Cloud Platform (GCP).","source":"@site/docs/03-guides/02-cloud-environment/02-deployment.md","sourceDirName":"03-guides/02-cloud-environment","slug":"/guides/cloud-environment/deployment","permalink":"/si-docs/guides/cloud-environment/deployment","draft":false,"unlisted":false,"editUrl":"https://github.com/EducationNetworkGroup/si-docs/tree/main/docs/03-guides/02-cloud-environment/02-deployment.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"Cloud Environment Overview","permalink":"/si-docs/guides/cloud-environment/overview"},"next":{"title":"Cost Management","permalink":"/si-docs/guides/cloud-environment/costs"}}');var i=r(4848),t=r(8453);const d={sidebar_position:2},c="Current Production Deployment (GCP Runtime)",o={},l=[{value:"Compute",id:"compute",level:2},{value:"Containers Running on the VM",id:"containers-running-on-the-vm",level:2},{value:"Authentication Flow (Keycloak)",id:"authentication-flow-keycloak",level:2},{value:"DNS + Reverse Proxy",id:"dns--reverse-proxy",level:2},{value:"Secrets &amp; Credentials",id:"secrets--credentials",level:2},{value:"Deployment (CI/CD)",id:"deployment-cicd",level:2}];function a(e){const n={br:"br",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"current-production-deployment-gcp-runtime",children:"Current Production Deployment (GCP Runtime)"})}),"\n",(0,i.jsxs)(n.p,{children:["This page describes the ",(0,i.jsx)(n.em,{children:"final deployed production environment"})," for Science Island on Google Cloud Platform (GCP)."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"compute",children:"Compute"}),"\n",(0,i.jsxs)(n.p,{children:["The entire platform runs on a ",(0,i.jsx)(n.strong,{children:"single Compute Engine VM"}),":"]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Component"}),(0,i.jsx)(n.th,{children:"Value"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"VM Name"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"si-compute-1-<id>"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Region / Zone"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"australia-southeast1-b"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Machine Type"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"e2-standard-2"})," (2 vCPU, 8GB RAM)"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Networking"}),(0,i.jsxs)(n.td,{children:["Private VPC (",(0,i.jsx)(n.code,{children:"10.10.0.0/24"}),"), External ",(0,i.jsx)(n.strong,{children:"Static IP"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"OS"}),(0,i.jsx)(n.td,{children:"Debian with Docker + Docker Compose"})]})]})]}),"\n",(0,i.jsxs)(n.p,{children:["This VM hosts ",(0,i.jsx)(n.strong,{children:"all services"})," via ",(0,i.jsx)(n.code,{children:"docker-compose.yml"}),"."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"containers-running-on-the-vm",children:"Containers Running on the VM"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Service Group"}),(0,i.jsx)(n.th,{children:"Purpose"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Caddy"})}),(0,i.jsx)(n.td,{children:"Reverse proxy + TLS"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Keycloak"})}),(0,i.jsx)(n.td,{children:"Authentication + SSO"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Platform Frontend & Microservices"})}),(0,i.jsx)(n.td,{children:"Teacher-facing system logic"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Curriculum Mapper"})}),(0,i.jsx)(n.td,{children:"Curriculum authoring and planning"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Postgres"})}),(0,i.jsx)(n.td,{children:"Keycloak data"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"MySQL + Redis"})}),(0,i.jsx)(n.td,{children:"Platform backend data + caching"})]})]})]}),"\n",(0,i.jsxs)(n.p,{children:["All services communicate via an ",(0,i.jsx)(n.strong,{children:"internal Docker network"}),". Only ",(0,i.jsx)(n.strong,{children:"Caddy"})," is externally exposed."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"authentication-flow-keycloak",children:"Authentication Flow (Keycloak)"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Login is performed via: ",(0,i.jsx)(n.code,{children:"https://login.scienceisland.com"})]}),"\n",(0,i.jsx)(n.li,{children:"Provides SSO for Platform + Game."}),"\n",(0,i.jsx)(n.li,{children:"Redirect URIs are configured individually per client."}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"dns--reverse-proxy",children:"DNS + Reverse Proxy"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Subdomain"}),(0,i.jsx)(n.th,{children:"Purpose"}),(0,i.jsx)(n.th,{children:"Destination"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"scienceisland.com"})}),(0,i.jsx)(n.td,{children:"Public landing website"}),(0,i.jsx)(n.td,{children:"Static IP \u2192 Caddy"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"login.scienceisland.com"})}),(0,i.jsx)(n.td,{children:"Keycloak login UI"}),(0,i.jsx)(n.td,{children:"Static IP \u2192 Keycloak container"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"platform.scienceisland.com"})}),(0,i.jsx)(n.td,{children:"Teacher Portal UI"}),(0,i.jsx)(n.td,{children:"Static IP \u2192 Platform frontend"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"mapper.scienceisland.com"})}),(0,i.jsx)(n.td,{children:"Curriculum Mapper UI"}),(0,i.jsx)(n.td,{children:"Static IP \u2192 Mapper frontend"})]})]})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"DNS is managed in Cloud DNS"}),".",(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)(n.strong,{children:"TLS certs are automatically issued and renewed by Caddy"}),"."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"secrets--credentials",children:"Secrets & Credentials"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Secret"}),(0,i.jsx)(n.th,{children:"Storage"}),(0,i.jsx)(n.th,{children:"Notes"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"keycloak-admin-password"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"GCP Secret Manager"})}),(0,i.jsx)(n.td,{children:"Used for Keycloak admin console"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"keycloak-db-password"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"GCP Secret Manager"})}),(0,i.jsx)(n.td,{children:"Used by Keycloak \u2192 Postgres"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsxs)(n.td,{children:["Platform service ",(0,i.jsx)(n.code,{children:".env"})," values"]}),(0,i.jsx)(n.td,{children:"Stored on VM"}),(0,i.jsx)(n.td,{children:"Should be migrated to Secret Manager later"})]})]})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"deployment-cicd",children:"Deployment (CI/CD)"}),"\n",(0,i.jsxs)(n.p,{children:["The platform uses ",(0,i.jsx)(n.strong,{children:"automated deployments"}),":"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Code is pushed to ",(0,i.jsx)(n.code,{children:"main"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"GitHub Actions"})," builds new Docker images."]}),"\n",(0,i.jsxs)(n.li,{children:["Images are pushed to ",(0,i.jsx)(n.strong,{children:"GitHub Container Registry (GHCR)"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["The ",(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"si-infra"})})," workflow connects to the VM and runs the following to restart services with the new versions:","\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"docker compose pull\ndocker compose up -d\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"\n### Rollback\n\nTo revert a deployment:\n\n1. Edit the relevant service\u2019s image tag in `docker-compose.yml` to a previous version.\n2. Commit the change to the `main` branch.\n3. The CI/CD workflow will automatically redeploy using the previous image.\n\nThis ensures versioned, repeatable rollbacks with no manual SSH intervention.\n\n---\n\n## Known Limitations\n\n| Limitation | Impact |\n|-----------|--------|\n| **Single VM deployment** | No horizontal scaling or redundancy \u2014 if the VM goes down, the whole platform is unavailable. |\n| **Manual Keycloak user provisioning** | User registration currently requires admin console access or API automation; no self-service sign-up yet. |\n| **Platform microservices tightly coupled** | Updates may require coordinated deployments; future refactor could improve modularity. |\n\n---\n\n## Operational Quick Reference\n\n| Task | Command |\n|------|---------|\n| Restart services | `docker compose up -d` |\n| Check logs for a service | `docker logs <container-name> --follow` |\n| Check running containers | `docker compose ps` |\n| SSH into the VM | `gcloud compute ssh si-compute-1-<id> --zone=australia-southeast1-b` |\n\n"})})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>d,x:()=>c});var s=r(6540);const i={},t=s.createContext(i);function d(e){const n=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);