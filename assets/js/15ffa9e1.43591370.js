"use strict";(self.webpackChunkscience_island_docs=self.webpackChunkscience_island_docs||[]).push([[7553],{6114:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"guides/repositories/keycloak","title":"Keycloak (si-auth-service)","description":"Central authentication service for the Science Island platform.","source":"@site/docs/03-guides/01-repositories/04-keycloak.md","sourceDirName":"03-guides/01-repositories","slug":"/guides/repositories/keycloak","permalink":"/si-docs/guides/repositories/keycloak","draft":false,"unlisted":false,"editUrl":"https://github.com/EducationNetworkGroup/si-docs/tree/main/docs/03-guides/01-repositories/04-keycloak.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"description":"Central authentication service for the Science Island platform."},"sidebar":"tutorialSidebar","previous":{"title":"Curriculum Mapper (Mapping-System-2022S2)","permalink":"/si-docs/guides/repositories/curriculum-mapper"},"next":{"title":"Setting up Pulumi (si-infrastructure)","permalink":"/si-docs/guides/repositories/pulumi"}}');var t=i(4848),r=i(8453);const o={sidebar_position:3,description:"Central authentication service for the Science Island platform."},l="Keycloak (si-auth-service)",c={},d=[{value:"Folder Structure",id:"folder-structure",level:2},{value:"Live Deployment",id:"live-deployment",level:2},{value:"Deployment Workflow",id:"deployment-workflow",level:3},{value:"Updating Realm Configuration",id:"updating-realm-configuration",level:3}];function a(e){const n={a:"a",blockquote:"blockquote",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"keycloak-si-auth-service",children:"Keycloak (si-auth-service)"})}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"si-auth-service"})," repository provides the ",(0,t.jsx)(n.strong,{children:"central authentication and Single Sign-On (SSO)"})," service for the Science Island platform using ",(0,t.jsx)(n.strong,{children:"Keycloak"}),".",(0,t.jsx)(n.br,{}),"\n","It includes the ",(0,t.jsx)(n.strong,{children:"version-controlled realm configuration"}),", ",(0,t.jsx)(n.strong,{children:"custom Science Island login theme"}),", and configuration for both ",(0,t.jsx)(n.strong,{children:"local development"})," and ",(0,t.jsx)(n.strong,{children:"production deployment"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["This service is shared by multiple platform applications, so changes to ",(0,t.jsx)(n.strong,{children:"clients, redirect URLs, roles, and groups"})," must follow the documented workflow to avoid breaking authentication."]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"folder-structure",children:"Folder Structure"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Path"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"themes/science-island/"})}),(0,t.jsx)(n.td,{children:"Custom Science Island login + account UI theme"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"realms/science-island.json"})}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.strong,{children:"Authoritative"})," Keycloak realm configuration (imported on startup)"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"caddy/"})}),(0,t.jsx)(n.td,{children:"Reverse proxy + HTTPS configuration for public access"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"scripts/"})}),(0,t.jsx)(n.td,{children:"Utility scripts (token generation, debugging)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"docker-compose.yml"})}),(0,t.jsx)(n.td,{children:"Local Keycloak + PostgreSQL development environment"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:".github/workflows/"})}),(0,t.jsx)(n.td,{children:"CI/CD pipelines for automated builds + Helm releases"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"Dockerfile"})}),(0,t.jsx)(n.td,{children:"Builds Keycloak image with the custom theme + realm configuration"})]})]})]}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"Helm is obsolete now as the live deployment was drastically simplified in the migration from AWS to GCP in 2025. Kubernetes was removed from the project in favour of a simple VM setup."}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"live-deployment",children:"Live Deployment"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Production Login URL:"}),(0,t.jsx)(n.br,{}),"\n",(0,t.jsx)(n.a,{href:"https://login.scienceisland.com",children:"https://login.scienceisland.com"})]}),"\n",(0,t.jsx)(n.h3,{id:"deployment-workflow",children:"Deployment Workflow"}),"\n",(0,t.jsxs)(n.p,{children:["This repository does ",(0,t.jsx)(n.strong,{children:"not"})," handle production deployment directly."]}),"\n",(0,t.jsxs)(n.p,{children:["Production deployment is managed in the ",(0,t.jsx)(n.strong,{children:"si-infrastructure"})," repository via CI/CD pipelines, which:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Build and publish the Keycloak container image"}),"\n",(0,t.jsx)(n.li,{children:"Apply Helm chart updates to the cluster"}),"\n",(0,t.jsx)(n.li,{children:"Manage rollout and versioning"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"No manual SSH access or container restarts are required."}),"\n",(0,t.jsx)(n.h3,{id:"updating-realm-configuration",children:"Updating Realm Configuration"}),"\n",(0,t.jsxs)(n.p,{children:["Changes made in the Keycloak Admin Console are ",(0,t.jsx)(n.strong,{children:"not automatically persisted"})," to this repository.",(0,t.jsx)(n.br,{}),"\n","If you do not export and commit the updated realm file, your changes will be ",(0,t.jsx)(n.strong,{children:"lost on redeployment"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"To persist changes:"}),"\n",(0,t.jsx)(n.p,{children:"To persist configuration changes:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Log into the ",(0,t.jsx)(n.strong,{children:"Keycloak Admin Console"})]}),"\n",(0,t.jsxs)(n.li,{children:["Navigate to: ",(0,t.jsx)(n.strong,{children:"Realm Settings \u2192 Export"})]}),"\n",(0,t.jsxs)(n.li,{children:["Set the export options:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Export users"})," \u2192 ",(0,t.jsx)(n.code,{children:"OFF"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Export groups and roles"})," \u2192 ",(0,t.jsx)(n.code,{children:"ON"})]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Click ",(0,t.jsx)(n.strong,{children:"Export"})," \u2192 a ",(0,t.jsx)(n.code,{children:".json"})," file will download"]}),"\n",(0,t.jsx)(n.li,{children:"Replace the file in this repository: realms/science-island.json"}),"\n",(0,t.jsx)(n.li,{children:"Commit and push the updated file:"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'git add realms/science-island.json\ngit commit -m "chore: update Keycloak realm configuration"\ngit push\n'})}),"\n",(0,t.jsx)(n.p,{children:"Important:\nThe realm file in this repository is exported without users on purpose.\nThere are demo/test accounts currently used for presentations (e.g., the account provided to the client) which exist only in the live Keycloak instance.\nThese accounts should not be stored in version control.\nIf demo accounts need to be recreated, they should be added manually through the Admin Console."})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>l});var s=i(6540);const t={},r=s.createContext(t);function o(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);