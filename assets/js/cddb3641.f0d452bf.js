"use strict";(self.webpackChunkscience_island_docs=self.webpackChunkscience_island_docs||[]).push([[8250],{8453:(e,s,n)=>{n.d(s,{R:()=>c,x:()=>o});var r=n(6540);const i={},t=r.createContext(i);function c(e){const s=r.useContext(t);return r.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),r.createElement(t.Provider,{value:s},e.children)}},8759:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>l,contentTitle:()=>o,default:()=>u,frontMatter:()=>c,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"guides/repositories/si-infrastructure","title":"Infrastructure (si-infrastructure)","description":"Infrastructure-as-Code repository for Science Island cloud resources.","source":"@site/docs/03-guides/01-repositories/06-si-infrastructure.md","sourceDirName":"03-guides/01-repositories","slug":"/guides/repositories/si-infrastructure","permalink":"/si-docs/guides/repositories/si-infrastructure","draft":false,"unlisted":false,"editUrl":"https://github.com/EducationNetworkGroup/si-docs/tree/main/docs/03-guides/01-repositories/06-si-infrastructure.md","tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"sidebar_position":6,"description":"Infrastructure-as-Code repository for Science Island cloud resources."},"sidebar":"tutorialSidebar","previous":{"title":"Setting up Pulumi (si-infrastructure)","permalink":"/si-docs/guides/repositories/pulumi"},"next":{"title":"Cloud Environment","permalink":"/si-docs/category/cloud-environment"}}');var i=n(4848),t=n(8453);const c={sidebar_position:6,description:"Infrastructure-as-Code repository for Science Island cloud resources."},o="Infrastructure (si-infrastructure)",l={},d=[{value:"Overview",id:"overview",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Folder Structure",id:"folder-structure",level:2},{value:"Quick Start",id:"quick-start",level:2},{value:"1. Install Dependencies",id:"1-install-dependencies",level:3},{value:"2. Authenticate with GCP",id:"2-authenticate-with-gcp",level:3},{value:"3. Login to Pulumi Backend",id:"3-login-to-pulumi-backend",level:3},{value:"4. Select Stack",id:"4-select-stack",level:3},{value:"Key Concepts",id:"key-concepts",level:2},{value:"Multi-Project Architecture",id:"multi-project-architecture",level:3},{value:"Deployment Order",id:"deployment-order",level:3},{value:"Common Commands",id:"common-commands",level:3},{value:"Working with Infrastructure",id:"working-with-infrastructure",level:2},{value:"Making Changes",id:"making-changes",level:3},{value:"Viewing Current State",id:"viewing-current-state",level:3},{value:"Troubleshooting",id:"troubleshooting",level:3},{value:"What&#39;s Deployed?",id:"whats-deployed",level:2}];function a(e){const s={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.header,{children:(0,i.jsx)(s.h1,{id:"infrastructure-si-infrastructure",children:"Infrastructure (si-infrastructure)"})}),"\n",(0,i.jsx)(s.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsxs)(s.p,{children:["The ",(0,i.jsx)(s.code,{children:"si-infrastructure"})," repository uses ",(0,i.jsx)(s.strong,{children:"Pulumi"})," to manage all cloud infrastructure for Science Island on ",(0,i.jsx)(s.strong,{children:"Google Cloud Platform (GCP)"}),". It enables version-controlled, reproducible infrastructure deployments using TypeScript."]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Purpose:"})," Provision and manage cloud resources (compute, storage, networking, DNS, IAM) for all Science Island services."]}),"\n",(0,i.jsxs)(s.admonition,{title:"Legacy AWS Infrastructure",type:"note",children:[(0,i.jsx)(s.p,{children:"Science Island is currently migrating from AWS to GCP. Some AWS resources may still exist in the project but are no longer actively used for production services."}),(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"For most development work, you only need to focus on the GCP infrastructure documented here."})}),(0,i.jsxs)(s.p,{children:["For details on the migration and any remaining AWS resources, see: ",(0,i.jsx)(s.a,{href:"/guides/cloud-environment/migration-aws-gcp/overview",children:"Cloud Environment \u2192 AWS to GCP Migration"})]})]}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.a,{href:"https://www.pulumi.com/docs/get-started/",children:"Pulumi CLI"})," - Infrastructure-as-Code tool"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.a,{href:"https://classic.yarnpkg.com/lang/en/docs/install/",children:"Node.js & Yarn"})," - Package management"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.a,{href:"https://cloud.google.com/sdk/docs/install",children:"GCP SDK"})," - GCP authentication"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"PULUMI_CONFIG_PASSPHRASE"})," - Contact your Team Lead for this secret"]}),"\n"]}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"folder-structure",children:"Folder Structure"}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Path"}),(0,i.jsx)(s.th,{children:"Description"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"src/gcp/compute/"})}),(0,i.jsx)(s.td,{children:"GCP VM running Docker Compose for Platform, Website, Keycloak, Mapper"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"src/gcp/dns/"})}),(0,i.jsx)(s.td,{children:"Cloud DNS zones and records (login, platform, mapper)"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"src/gcp/iam/"})}),(0,i.jsx)(s.td,{children:"Service accounts and IAM roles for deployments"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"src/gcp/storage/"})}),(0,i.jsx)(s.td,{children:"Cloud Storage buckets for state and backups"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"scripts/"})}),(0,i.jsx)(s.td,{children:"Utility scripts (access tokens, JWT)"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"Pulumi.prod.yaml"})}),(0,i.jsx)(s.td,{children:"Production stack configuration"})]})]})]}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"quick-start",children:"Quick Start"}),"\n",(0,i.jsx)(s.h3,{id:"1-install-dependencies",children:"1. Install Dependencies"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"yarn\n"})}),"\n",(0,i.jsx)(s.h3,{id:"2-authenticate-with-gcp",children:"2. Authenticate with GCP"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"gcloud auth application-default login\ngcloud config set project science-island-465603\n"})}),"\n",(0,i.jsx)(s.h3,{id:"3-login-to-pulumi-backend",children:"3. Login to Pulumi Backend"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"pulumi login 'gs://si-iac-state'\n"})}),"\n",(0,i.jsx)(s.h3,{id:"4-select-stack",children:"4. Select Stack"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"cd src/gcp/compute  # or any module\npulumi stack select organization/prod\n"})}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"key-concepts",children:"Key Concepts"}),"\n",(0,i.jsx)(s.h3,{id:"multi-project-architecture",children:"Multi-Project Architecture"}),"\n",(0,i.jsxs)(s.p,{children:["Each cloud service (compute, DNS, storage, etc.) is a ",(0,i.jsx)(s.strong,{children:"separate Pulumi project"})," with its own state. This allows:"]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Independent deployments"}),"\n",(0,i.jsx)(s.li,{children:"Focused change management"}),"\n",(0,i.jsx)(s.li,{children:"Reduced blast radius for errors"}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"deployment-order",children:"Deployment Order"}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"GCP modules have dependencies:"})}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Phase 1"})," (parallel): IAM, Storage, Compute"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Phase 2"}),": DNS (depends on Compute IP)"]}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"common-commands",children:"Common Commands"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"# Preview changes before applying\npulumi preview\n\n# Deploy infrastructure\npulumi up\n\n# View stack outputs (e.g., VM IP, DNS records)\npulumi stack output\n\n# Destroy resources (use with caution!)\npulumi destroy\n"})}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"working-with-infrastructure",children:"Working with Infrastructure"}),"\n",(0,i.jsx)(s.h3,{id:"making-changes",children:"Making Changes"}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsx)(s.li,{children:"Create a feature branch"}),"\n",(0,i.jsxs)(s.li,{children:["Navigate to the relevant module (e.g., ",(0,i.jsx)(s.code,{children:"src/gcp/compute/"}),")"]}),"\n",(0,i.jsxs)(s.li,{children:["Run ",(0,i.jsx)(s.code,{children:"pulumi preview"})," to see planned changes"]}),"\n",(0,i.jsx)(s.li,{children:"Create a PR for team review"}),"\n",(0,i.jsx)(s.li,{children:"After approval, merge triggers automatic deployment via GitHub Actions"}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"viewing-current-state",children:"Viewing Current State"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"cd src/gcp/compute\npulumi stack output --show-secrets\n"})}),"\n",(0,i.jsx)(s.h3,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"GCP VM Issues:"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"cd src/gcp/compute\n./ssh-into-instance.sh\nsudo docker compose ps\nsudo docker compose logs <service-name>\n"})}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"whats-deployed",children:"What's Deployed?"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Compute Engine VM"}),": Hosts all services via Docker Compose"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Cloud DNS"}),": Routes traffic to login.scienceisland.org, platform.scienceisland.org"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Filestore"}),": Persistent storage for services"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Service Accounts"}),": CI/CD deployment credentials"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Cloud Storage Buckets"}),": State management and backups"]}),"\n"]})]})}function u(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}}}]);