"use strict";(self.webpackChunkscience_island_docs=self.webpackChunkscience_island_docs||[]).push([[1082],{5270:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>t,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"guides/cloud-environment/migration-aws-gcp/data-migration","title":"Data Migration & Cutover","description":"This section covers the migration of data services from AWS to GCP and the step-by-step playbook for the final cutover.","source":"@site/docs/03-guides/02-cloud-environment/03-migration-aws-gcp/04-data-migration.md","sourceDirName":"03-guides/02-cloud-environment/03-migration-aws-gcp","slug":"/guides/cloud-environment/migration-aws-gcp/data-migration","permalink":"/si-docs/guides/cloud-environment/migration-aws-gcp/data-migration","draft":false,"unlisted":false,"editUrl":"https://github.com/EducationNetworkGroup/si-docs/tree/main/docs/03-guides/02-cloud-environment/03-migration-aws-gcp/04-data-migration.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4},"sidebar":"tutorialSidebar","previous":{"title":"Infrastructure & Deployment","permalink":"/si-docs/guides/cloud-environment/migration-aws-gcp/infrastructure-deployment"},"next":{"title":"Networking & Operations","permalink":"/si-docs/guides/cloud-environment/migration-aws-gcp/networking-operations"}}');var r=i(4848),o=i(8453);const l={sidebar_position:4},t="Data Migration & Cutover",a={},d=[{value:"\ud83d\udce6 Object Storage Migration (S3 \u2192 Cloud Storage)",id:"-object-storage-migration-s3--cloud-storage",level:2},{value:"\ud83d\uddc4 Database Migration (RDS \u2192 Cloud SQL)",id:"-database-migration-rds--cloud-sql",level:2},{value:"\ud83d\udd11 Keycloak Database Migration",id:"-keycloak-database-migration",level:2},{value:"\ud83e\udded Cutover Playbook",id:"-cutover-playbook",level:2},{value:"Pre-Cutover (T-48h)",id:"pre-cutover-t-48h",level:3},{value:"Final Sync (T-0h)",id:"final-sync-t-0h",level:3},{value:"Cutover Execution",id:"cutover-execution",level:3},{value:"Post-Cutover Validation",id:"post-cutover-validation",level:3},{value:"\ud83d\uded1 Rollback Plan",id:"-rollback-plan",level:2},{value:"\u2705 Deliverables",id:"-deliverables",level:2}];function c(e){const n={br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"data-migration--cutover",children:"Data Migration & Cutover"})}),"\n",(0,r.jsxs)(n.p,{children:["This section covers the migration of data services from AWS to GCP and the step-by-step playbook for the final cutover.",(0,r.jsx)(n.br,{}),"\n","The focus areas are ",(0,r.jsx)(n.strong,{children:"object storage"}),", ",(0,r.jsx)(n.strong,{children:"relational databases"}),", and ",(0,r.jsx)(n.strong,{children:"Keycloak"}),", followed by the cutover and rollback strategy."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"-object-storage-migration-s3--cloud-storage",children:"\ud83d\udce6 Object Storage Migration (S3 \u2192 Cloud Storage)"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Buckets"}),": Each S3 bucket is recreated in GCS with the same naming convention."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Transfer Options"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Storage Transfer Service"})," for large datasets."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"gcloud storage cp"})})," for small or one-off transfers."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Metadata"}),": ACLs, encryption, and versioning reapplied in GCS."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Validation"}),": Random file samples checked for integrity and accessibility."]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"Deliverable"}),": All required assets migrated to Cloud Storage, with equivalent access and encryption policies."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"-database-migration-rds--cloud-sql",children:"\ud83d\uddc4 Database Migration (RDS \u2192 Cloud SQL)"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Provisioning"}),": Cloud SQL Postgres instance created in ",(0,r.jsx)(n.code,{children:"australia-southeast1"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Export/Import"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"pg_dump"})," from RDS."]}),"\n",(0,r.jsxs)(n.li,{children:["Import into Cloud SQL using ",(0,r.jsx)(n.code,{children:"pg_restore"})," or ",(0,r.jsx)(n.code,{children:"gcloud sql import"}),"."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Validation"}),": Compare row counts, roles, extensions, and sequences."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Integration"}),": Application configs updated to use Cloud SQL connectors."]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"Deliverable"}),": Cloud SQL seeded with production data and verified."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"-keycloak-database-migration",children:"\ud83d\udd11 Keycloak Database Migration"}),"\n",(0,r.jsx)(n.p,{children:"Keycloak\u2019s persistence layer relies on Postgres. Migrating its schema is critical."}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Schema"}),": Pre-provisioned in Cloud SQL to avoid mismatch."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Backup"}),": Export RDS Keycloak schema separately as an additional safeguard."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Restore"}),": Import into Cloud SQL, validate key tables (",(0,r.jsx)(n.code,{children:"user_entity"}),", ",(0,r.jsx)(n.code,{children:"realm"}),", ",(0,r.jsx)(n.code,{children:"client"}),", ",(0,r.jsx)(n.code,{children:"role"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Testing"}),": Run Keycloak in staging against Cloud SQL, confirm:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Realms exist."}),"\n",(0,r.jsx)(n.li,{children:"Users and credentials are intact."}),"\n",(0,r.jsx)(n.li,{children:"Clients retain redirect URIs."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"Deliverable"}),": Keycloak fully functional on Cloud SQL, verified via admin console and test logins."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"-cutover-playbook",children:"\ud83e\udded Cutover Playbook"}),"\n",(0,r.jsx)(n.h3,{id:"pre-cutover-t-48h",children:"Pre-Cutover (T-48h)"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Lower DNS TTLs in Route 53 to 60s."}),"\n",(0,r.jsx)(n.li,{children:"Validate Cloud SQL + Keycloak staging."}),"\n",(0,r.jsx)(n.li,{children:"Confirm S3 \u2192 GCS sync is up to date."}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"final-sync-t-0h",children:"Final Sync (T-0h)"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Freeze writes or announce downtime window."}),"\n",(0,r.jsx)(n.li,{children:"Run last RDS \u2192 Cloud SQL sync."}),"\n",(0,r.jsx)(n.li,{children:"Run last S3 \u2192 GCS delta sync."}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"cutover-execution",children:"Cutover Execution"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Update registrar NS records \u2192 Cloud DNS."}),"\n",(0,r.jsx)(n.li,{children:"Switch apps (including Keycloak) to use Cloud SQL and GCS."}),"\n",(0,r.jsx)(n.li,{children:"Restart Docker Compose on GCE VM to pull latest images."}),"\n",(0,r.jsx)(n.li,{children:"Validate Keycloak login, app DB queries, and file uploads."}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"post-cutover-validation",children:"Post-Cutover Validation"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Monitor p95 latency, error rate, and auth flows in Cloud Monitoring."}),"\n",(0,r.jsx)(n.li,{children:"Verify Cloud Logging for app/Keycloak logs."}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"-rollback-plan",children:"\ud83d\uded1 Rollback Plan"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"DNS"}),": Switch NS back to Route 53 if issues occur."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Database"}),": Restore from RDS snapshot if Cloud SQL corrupt."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Storage"}),": Continue serving from S3 if GCS sync incomplete."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"App"}),": Redeploy previous Keycloak + app versions from AWS."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Rollback window is viable while TTL = 60s and AWS infra is still intact."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"-deliverables",children:"\u2705 Deliverables"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"All S3 buckets migrated to GCS."}),"\n",(0,r.jsx)(n.li,{children:"Cloud SQL provisioned, populated, and validated."}),"\n",(0,r.jsx)(n.li,{children:"Keycloak connected and verified against Cloud SQL."}),"\n",(0,r.jsx)(n.li,{children:"Cutover and rollback procedure documented and tested."}),"\n"]}),"\n",(0,r.jsx)(n.hr,{})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>l,x:()=>t});var s=i(6540);const r={},o=s.createContext(r);function l(e){const n=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);