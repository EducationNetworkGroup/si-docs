"use strict";(self.webpackChunkscience_island_docs=self.webpackChunkscience_island_docs||[]).push([[2534],{2577:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>u,frontMatter:()=>l,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"guides/cloud-environment/migration-aws-gcp/infrastructure-deployment","title":"Infrastructure & Deployment","description":"This section covers the setup of core infrastructure on GCP and how we build and deploy applications \u2014 with Keycloak as the central example.","source":"@site/docs/03-guides/02-cloud-environment/03-migration-aws-gcp/03-infrastructure-deployment.md","sourceDirName":"03-guides/02-cloud-environment/03-migration-aws-gcp","slug":"/guides/cloud-environment/migration-aws-gcp/infrastructure-deployment","permalink":"/si-docs/guides/cloud-environment/migration-aws-gcp/infrastructure-deployment","draft":false,"unlisted":false,"editUrl":"https://github.com/EducationNetworkGroup/si-docs/tree/main/docs/03-guides/02-cloud-environment/03-migration-aws-gcp/03-infrastructure-deployment.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"tutorialSidebar","previous":{"title":"Service Mapping: AWS \u2192 GCP","permalink":"/si-docs/guides/cloud-environment/migration-aws-gcp/service-mapping"},"next":{"title":"Data Migration & Cutover","permalink":"/si-docs/guides/cloud-environment/migration-aws-gcp/data-migration"}}');var r=i(4848),t=i(8453);const l={sidebar_position:3},o="Infrastructure & Deployment",c={},d=[{value:"\ud83c\udf10 DNS Setup",id:"-dns-setup",level:2},{value:"\ud83d\uddc4 Database Setup",id:"-database-setup",level:2},{value:"\ud83d\udd11 Keycloak Server Setup",id:"-keycloak-server-setup",level:2},{value:"\ud83c\udfd7 CI/CD Builds",id:"-cicd-builds",level:2},{value:"\ud83d\ude80 Deployment Flow",id:"-deployment-flow",level:2},{value:"\ud83d\udee1 Security Considerations",id:"-security-considerations",level:2},{value:"\u2705 Deliverables",id:"-deliverables",level:2}];function a(e){const n={br:"br",code:"code",h1:"h1",h2:"h2",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"infrastructure--deployment",children:"Infrastructure & Deployment"})}),"\n",(0,r.jsxs)(n.p,{children:["This section covers the setup of core infrastructure on GCP and how we build and deploy applications \u2014 with ",(0,r.jsx)(n.strong,{children:"Keycloak"})," as the central example."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"-dns-setup",children:"\ud83c\udf10 DNS Setup"}),"\n",(0,r.jsxs)(n.p,{children:["We are moving DNS management from ",(0,r.jsx)(n.strong,{children:"Route 53"})," (AWS) to ",(0,r.jsx)(n.strong,{children:"Cloud DNS"})," (GCP)."]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Managed Zone"}),": A Cloud DNS zone mirrors the existing Route 53 setup."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Records"}),": All A, CNAME, MX, and TXT records copied and validated."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Cutover"}),": Route 53 remains authoritative until migration day."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Keycloak Hostname"}),": ",(0,r.jsx)(n.code,{children:"auth.<domain>"})," is reserved, with TLS enabled."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Low TTLs"}),": Records reduced to 60s to allow quick rollback."]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"-database-setup",children:"\ud83d\uddc4 Database Setup"}),"\n",(0,r.jsxs)(n.p,{children:["We are migrating from ",(0,r.jsx)(n.strong,{children:"RDS Postgres"})," to ",(0,r.jsx)(n.strong,{children:"Cloud SQL Postgres"}),"."]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Provisioning"}),": Regional instance in ",(0,r.jsx)(n.code,{children:"australia-southeast1"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Security"}),": Only accessible via service accounts; secrets managed in ",(0,r.jsx)(n.strong,{children:"Secret Manager"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Migration Path"}),": RDS \u2192 ",(0,r.jsx)(n.code,{children:"pg_dump"})," \u2192 import into Cloud SQL."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Validation"}),": Schema, roles, sequences, and row counts checked."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Integration"}),": Applications (including Keycloak) connect via Cloud SQL connectors."]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"-keycloak-server-setup",children:"\ud83d\udd11 Keycloak Server Setup"}),"\n",(0,r.jsx)(n.p,{children:"Keycloak is the central service for authentication and identity in this project."}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Deployment Target"}),": Compute Engine VM with Docker Compose for dev/test; production uses containerized deployment."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Database Integration"}),": Keycloak connects to Cloud SQL with a dedicated schema and user."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Networking"}),": Publicly available via ",(0,r.jsx)(n.code,{children:"auth.<domain>"})," with HTTPS termination."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Secrets"}),": Stored in ",(0,r.jsx)(n.strong,{children:"Secret Manager"}),", injected at runtime."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Scaling"}),": Designed for future expansion with Cloud Load Balancing and multiple replicas."]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"-cicd-builds",children:"\ud83c\udfd7 CI/CD Builds"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Source"}),": Code hosted in GitHub."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Builds"}),": Cloud Build runs on commits to ",(0,r.jsx)(n.code,{children:"main"})," or ",(0,r.jsx)(n.code,{children:"release/*"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Artifacts"}),": Images tagged and pushed to ",(0,r.jsx)(n.strong,{children:"Artifact Registry"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Keycloak build:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Custom Dockerfile bundles realm configuration and provider plugins."}),"\n",(0,r.jsxs)(n.li,{children:["Image stored in Artifact Registry under",(0,r.jsx)(n.br,{}),"\n",(0,r.jsx)(n.code,{children:"australia-southeast1-docker.pkg.dev/<project>/<repo>/keycloak:<tag>"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"-deployment-flow",children:"\ud83d\ude80 Deployment Flow"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Target"}),": Compute Engine VM (",(0,r.jsx)(n.code,{children:"australia-southeast1-b"}),")."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Process"}),":"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Cloud Build completes."}),"\n",(0,r.jsx)(n.li,{children:"Deployment job triggers."}),"\n",(0,r.jsx)(n.li,{children:"VM pulls new image from Artifact Registry."}),"\n",(0,r.jsx)(n.li,{children:"Docker Compose restarts Keycloak and supporting containers."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Rollback"}),": Redeploy a previous image tag. Cached layers speed up recovery."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"-security-considerations",children:"\ud83d\udee1 Security Considerations"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Service accounts have least-privilege roles."}),"\n",(0,r.jsx)(n.li,{children:"Artifact Registry access scoped only to deployer."}),"\n",(0,r.jsxs)(n.li,{children:["Secrets managed in ",(0,r.jsx)(n.strong,{children:"Secret Manager"}),", never stored in repo."]}),"\n",(0,r.jsx)(n.li,{children:"VM firewall limited to 80/443; SSH access restricted."}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"-deliverables",children:"\u2705 Deliverables"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Cloud DNS zone mirroring Route 53 with Keycloak hostname reserved."}),"\n",(0,r.jsx)(n.li,{children:"Cloud SQL Postgres provisioned and validated."}),"\n",(0,r.jsx)(n.li,{children:"Keycloak server architecture ready on GCP."}),"\n",(0,r.jsx)(n.li,{children:"Reproducible builds with Cloud Build."}),"\n",(0,r.jsx)(n.li,{children:"Automated deployments with rollback capability."}),"\n"]}),"\n",(0,r.jsx)(n.hr,{})]})}function u(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>l,x:()=>o});var s=i(6540);const r={},t=s.createContext(r);function l(e){const n=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);