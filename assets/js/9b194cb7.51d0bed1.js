"use strict";(self.webpackChunkscience_island_docs=self.webpackChunkscience_island_docs||[]).push([[6250],{5805:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"tools-and-technologies/github-actions-and-workflows/cicd-pipeline","title":"CI/CD Pipeline","description":"Understanding Science Island\'s CI/CD Pipeline.","source":"@site/docs/02-tools-and-technologies/02-github-actions-and-workflows/02-cicd-pipeline.md","sourceDirName":"02-tools-and-technologies/02-github-actions-and-workflows","slug":"/tools-and-technologies/github-actions-and-workflows/cicd-pipeline","permalink":"/si-docs/tools-and-technologies/github-actions-and-workflows/cicd-pipeline","draft":false,"unlisted":false,"editUrl":"https://github.com/EducationNetworkGroup/si-docs/tree/main/docs/02-tools-and-technologies/02-github-actions-and-workflows/02-cicd-pipeline.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"description":"Understanding Science Island\'s CI/CD Pipeline."},"sidebar":"tutorialSidebar","previous":{"title":"The Basics","permalink":"/si-docs/tools-and-technologies/github-actions-and-workflows/the-basics"},"next":{"title":"Workflows","permalink":"/si-docs/tools-and-technologies/github-actions-and-workflows/workflows"}}');var r=i(4848),t=i(8453);const o={sidebar_position:2,description:"Understanding Science Island's CI/CD Pipeline."},l="CI/CD Pipeline",c={},d=[{value:"Intended Workflow",id:"intended-workflow",level:2},{value:"Creating a Git Tag",id:"creating-a-git-tag",level:3},{value:"Repositories Requiring Manual Updates",id:"repositories-requiring-manual-updates",level:3},{value:"Creating an Empty Commit",id:"creating-an-empty-commit",level:3},{value:"How the Pipeline Works",id:"how-the-pipeline-works",level:2},{value:"1. Publish Workflows",id:"1-publish-workflows",level:3},{value:"2. Trigger Deployment",id:"2-trigger-deployment",level:3},{value:"3. Update Deployed Versions",id:"3-update-deployed-versions",level:3},{value:"4. Infrastructure Updates",id:"4-infrastructure-updates",level:3},{value:"Cancel Pulumi Lock",id:"cancel-pulumi-lock",level:2},{value:"When to Use",id:"when-to-use",level:3},{value:"How to Run",id:"how-to-run",level:3}];function a(e){const n={a:"a",blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"cicd-pipeline",children:"CI/CD Pipeline"})}),"\n",(0,r.jsx)(n.p,{children:"This guide explains Science Island's continuous integration and continuous deployment (CI/CD) pipeline, including the intended workflow for developers and how the automated deployment system operates."}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Note: Science Island migrated from AWS with Kubernetes to a simplified GCP VM-based deployment in 2025. Helm charts are still published to GHCR (legacy from the Kubernetes era) but are no longer used for deployment. Services now run on virtual machines using Docker Compose instead of Kubernetes orchestration."}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"intended-workflow",children:"Intended Workflow"}),"\n",(0,r.jsx)(n.p,{children:"When working on Science Island projects, follow this workflow to ensure smooth deployments:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Create a branch"})," - Make a new branch from ",(0,r.jsx)(n.code,{children:"main"})," to do your work in."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Submit a Pull Request (PR)"})," - When your work is complete, create a PR to merge your changes back into ",(0,r.jsx)(n.code,{children:"main"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Resolve build issues"})," - Some repositories have workflows that validate PR builds. Ensure all build checks pass before merging."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Merge the PR"})," - Once approved and passing all checks, merge your PR into the ",(0,r.jsx)(n.code,{children:"main"})," branch."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Create a new tag"})," - After merging, create a new tag for the repository. See ",(0,r.jsx)(n.a,{href:"#creating-a-git-tag",children:"Creating a Git Tag"})," below."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Manual updates (temporary workaround)"})," - For repositories where the Trigger Deployment step doesn't currently work (see ",(0,r.jsx)(n.a,{href:"#repositories-requiring-manual-updates",children:"Repositories Requiring Manual Updates"}),"), manually update the version tag in ",(0,r.jsx)(n.code,{children:"Pulumi.prod.yaml"}),". When you commit and push this change, it will automatically trigger the ",(0,r.jsx)(n.code,{children:"Pulumi-Up.yaml"})," workflow, allowing you to ",(0,r.jsx)(n.em,{children:"skip Step 7"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Push empty commit (temporary workaround)"})," - ",(0,r.jsx)(n.code,{children:"Trigger-Deployment.yaml"})," doesn't currently trigger ",(0,r.jsx)(n.code,{children:"Pulumi-Up.yaml"})," automatically. See ",(0,r.jsx)(n.a,{href:"#creating-an-empty-commit",children:"Creating an Empty Commit"})," below."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"creating-a-git-tag",children:"Creating a Git Tag"}),"\n",(0,r.jsx)(n.p,{children:"Tags are essential for triggering deployments. Without an updated tag, the deployment will fail even if the code is merged. To create and push a new tag:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Create a new tag (use semantic versioning: v1.2.3)\ngit tag v1.2.3\n\n# Push all tags to the remote repository\ngit push --tags\n"})}),"\n",(0,r.jsx)(n.h3,{id:"repositories-requiring-manual-updates",children:"Repositories Requiring Manual Updates"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"Mapping-System-2022S2"})," and ",(0,r.jsx)(n.code,{children:"si-auth-service"})," repositories have Trigger Deployment steps that ",(0,r.jsx)(n.em,{children:"do not currently work"}),". After merging and tagging in these repositories, you must manually update ",(0,r.jsx)(n.code,{children:"Pulumi.prod.yaml"})," in the ",(0,r.jsx)(n.code,{children:"si-infrastructure"})," repository:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"  gcp-compute:deployed-versions.si-auth-service: 1.1.2\n  gcp-compute:deployed-versions.si-auth-service.image: v0.0.6                 #<---- Update to your new git tag for si-auth-service\n  gcp-compute:deployed-versions.si-curriculum-mapper-backend: 1.0.0\n  gcp-compute:deployed-versions.si-curriculum-mapper-backend.image: v0.0.1    #<---- Update to your new git tag for Mapping-System-2022S2\n  gcp-compute:deployed-versions.si-curriculum-mapper-frontend: 1.0.0\n  gcp-compute:deployed-versions.si-curriculum-mapper-frontend.image: v0.0.1   #<---- Update to your new git tag for Mapping-System-2022S2\n"})}),"\n",(0,r.jsxs)(n.p,{children:["For all other repositories (e.g., ",(0,r.jsx)(n.code,{children:"ScienceIslandWebsite"}),", ",(0,r.jsx)(n.code,{children:"Platform"}),"), the Trigger Deployment step functions correctly and will automatically trigger ",(0,r.jsx)(n.code,{children:"Trigger-Deployment.yaml"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"creating-an-empty-commit",children:"Creating an Empty Commit"}),"\n",(0,r.jsxs)(n.p,{children:["An empty commit can be used to trigger workflows without making actual code changes. This is currently needed to manually trigger the ",(0,r.jsx)(n.code,{children:"Pulumi-Up.yaml"})," workflow in the ",(0,r.jsx)(n.code,{children:"si-infrastructure"})," repository:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# Create an empty commit with a message\ngit commit --allow-empty -m "Trigger deployment"\n\n# Push the commit to the remote repository\ngit push origin main\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"how-the-pipeline-works",children:"How the Pipeline Works"}),"\n",(0,r.jsx)(n.p,{children:"Science Island's CI/CD pipeline automates the entire deployment process from code commit to production deployment. The pipeline follows this sequence:"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Step"}),(0,r.jsx)(n.th,{children:"Component"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"1"})}),(0,r.jsx)(n.td,{children:"Publish workflows"}),(0,r.jsx)(n.td,{children:"Builds and publishes Docker images and Helm charts to GHCR from application repositories."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"2"})}),(0,r.jsx)(n.td,{children:"Trigger Deployment event"}),(0,r.jsxs)(n.td,{children:["Sends deployment event from application repositories to ",(0,r.jsx)(n.code,{children:"si-infrastructure"}),"."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"3"})}),(0,r.jsx)(n.td,{children:"Update deployed versions"}),(0,r.jsxs)(n.td,{children:["Updates ",(0,r.jsx)(n.code,{children:"Pulumi.prod.yaml"})," with new chart versions and image tags in ",(0,r.jsx)(n.code,{children:"si-infrastructure"}),"."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"4"})}),(0,r.jsx)(n.td,{children:"Infrastructure updates"}),(0,r.jsx)(n.td,{children:"Applies changes to GCP resources and redeploys services on virtual machines."})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"1-publish-workflows",children:"1. Publish Workflows"}),"\n",(0,r.jsxs)(n.p,{children:["When code is pushed to the ",(0,r.jsx)(n.code,{children:"main"})," branch of an application repository (e.g., ",(0,r.jsx)(n.code,{children:"ScienceIslandWebsite"}),", ",(0,r.jsx)(n.code,{children:"Platform"}),"), a publish workflow automatically:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Builds a Docker container image"}),"\n",(0,r.jsx)(n.li,{children:"Publishes the image to GitHub Container Registry (GHCR)"}),"\n",(0,r.jsx)(n.li,{children:"Publishes a Helm chart to GHCR (legacy - not used for deployment)"}),"\n",(0,r.jsx)(n.li,{children:"Triggers a deployment event"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Each application repository has its own publish workflow (e.g., ",(0,r.jsx)(n.code,{children:"Publish-Server.yaml"}),", ",(0,r.jsx)(n.code,{children:"Publish-Client.yaml"}),", ",(0,r.jsx)(n.code,{children:"Publish.yaml"}),")."]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Note: While Helm charts are still published, they are no longer used in the deployment process. Services are deployed using Docker Compose on virtual machines."}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"2-trigger-deployment",children:"2. Trigger Deployment"}),"\n",(0,r.jsxs)(n.p,{children:["At the end of each publish workflow, a ",(0,r.jsx)(n.code,{children:"Trigger Deployment"})," event is created and sent to the ",(0,r.jsx)(n.code,{children:"si-infrastructure"})," repository with the following information:"]}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Field"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"chart"})}),(0,r.jsxs)(n.td,{children:["The name of the service/application (e.g., ",(0,r.jsx)(n.code,{children:"si-platform-frontend"}),"). Legacy naming from Kubernetes era."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"version"})}),(0,r.jsxs)(n.td,{children:["The version number (e.g., ",(0,r.jsx)(n.code,{children:"1.2.3"}),")."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"image"})}),(0,r.jsxs)(n.td,{children:["The image tag to deploy (e.g., ",(0,r.jsx)(n.code,{children:"main"}),")."]})]})]})]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:'Note: The term "chart" is legacy terminology from when Kubernetes/Helm was used. It now simply refers to the service name for tracking deployment versions.'}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"3-update-deployed-versions",children:"3. Update Deployed Versions"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"Trigger-Deployment.yaml"})," workflow in ",(0,r.jsx)(n.code,{children:"si-infrastructure"})," listens for the Trigger Deployment event. When triggered, it:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Pulls the latest changes from the ",(0,r.jsx)(n.code,{children:"si-infrastructure"})," repository"]}),"\n",(0,r.jsxs)(n.li,{children:["Updates the service versions and image tags in ",(0,r.jsx)(n.code,{children:"Pulumi.prod.yaml"})," (located in the root of ",(0,r.jsx)(n.code,{children:"si-infrastructure"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:["Commits and pushes these changes to the ",(0,r.jsx)(n.code,{children:"main"})," branch"]}),"\n"]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:['Note: The configuration file tracks "chart" versions as a legacy naming convention. These values control which Docker image versions are deployed via Docker Compose. For repositories where the Trigger Deployment step doesn\'t work (',(0,r.jsx)(n.code,{children:"Mapping-System-2022S2"}),", ",(0,r.jsx)(n.code,{children:"si-auth-service"}),"), this file must be updated manually."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"4-infrastructure-updates",children:"4. Infrastructure Updates"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"Pulumi-Up.yaml"})," workflow in ",(0,r.jsx)(n.code,{children:"si-infrastructure"})," listens for commits to the ",(0,r.jsx)(n.code,{children:"main"})," branch. When it detects changes to the Pulumi configuration file, it:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Updates GCP resources (compute, storage, IAM)"}),"\n",(0,r.jsx)(n.li,{children:"Updates DNS configuration"}),"\n",(0,r.jsx)(n.li,{children:"Re-deploys any service with an updated version or image tag on the virtual machines using Docker Compose"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"The Pulumi workflow runs in two phases to ensure dependencies are created in the correct order:"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Phase"}),(0,r.jsx)(n.th,{children:"Projects"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"Phase 1"})}),(0,r.jsx)(n.td,{children:"compute, storage, iam"}),(0,r.jsx)(n.td,{children:"Creates and updates core infrastructure resources."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"Phase 2"})}),(0,r.jsx)(n.td,{children:"dns"}),(0,r.jsx)(n.td,{children:"Updates DNS configuration. Depends on Phase 1 resources."})]})]})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"cancel-pulumi-lock",children:"Cancel Pulumi Lock"}),"\n",(0,r.jsxs)(n.p,{children:["When working with Pulumi for infrastructure as code, state files can become locked if a workflow is interrupted or fails unexpectedly. The ",(0,r.jsx)(n.code,{children:"Pulumi-Cancel.yaml"})," workflow provides a manual way to release these locks."]}),"\n",(0,r.jsx)(n.h3,{id:"when-to-use",children:"When to Use"}),"\n",(0,r.jsx)(n.p,{children:"Use this workflow when:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"A Pulumi workflow fails mid-execution and leaves a lock"}),"\n",(0,r.jsx)(n.li,{children:"You need to cancel a long-running Pulumi operation"}),"\n",(0,r.jsx)(n.li,{children:"Multiple workflows conflict and create a deadlock"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"how-to-run",children:"How to Run"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"Pulumi-Cancel.yaml"})," workflow is triggered manually via workflow dispatch:"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Navigate to the Actions tab in the ",(0,r.jsx)(n.code,{children:"si-infrastructure"})," repository"]}),"\n",(0,r.jsx)(n.li,{children:'Select the "Cancel Pulumi Lock" workflow'}),"\n",(0,r.jsx)(n.li,{children:'Click "Run workflow"'}),"\n",(0,r.jsx)(n.li,{children:"Choose which project to cancel the lock for"}),"\n"]}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Option"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"compute"})}),(0,r.jsx)(n.td,{children:"Compute resources (VMs, deployments)."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"storage"})}),(0,r.jsx)(n.td,{children:"Storage buckets and volumes."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"iam"})}),(0,r.jsx)(n.td,{children:"Service accounts and permissions."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"dns"})}),(0,r.jsx)(n.td,{children:"DNS records and routing."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"all"})}),(0,r.jsx)(n.td,{children:"Cancel locks for all projects."})]})]})]}),"\n",(0,r.jsx)(n.p,{children:"The workflow will connect to the Pulumi state backend and cancel any active locks for the selected project(s)."})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>l});var s=i(6540);const r={},t=s.createContext(r);function o(e){const n=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);